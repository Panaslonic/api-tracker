# üèóÔ∏è API Watcher V2 - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

## üìê –û–±—â–∞—è —Å—Ö–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        API Watcher V2                            ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  ‚îÇ   URLs.json  ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Watcher V2  ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   Database   ‚îÇ      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îÇ                              ‚îÇ                                    ‚îÇ
‚îÇ                              ‚ñº                                    ‚îÇ
‚îÇ                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                           ‚îÇ
‚îÇ                    ‚îÇ  Content Fetch  ‚îÇ                           ‚îÇ
‚îÇ                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                           ‚îÇ
‚îÇ                             ‚îÇ                                     ‚îÇ
‚îÇ              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îÇ
‚îÇ              ‚ñº              ‚ñº               ‚ñº                    ‚îÇ
‚îÇ        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê               ‚îÇ
‚îÇ        ‚îÇ Direct  ‚îÇ    ‚îÇZenRows  ‚îÇ    ‚îÇ Parser  ‚îÇ               ‚îÇ
‚îÇ        ‚îÇ Request ‚îÇ    ‚îÇ  API    ‚îÇ    ‚îÇ (HTML)  ‚îÇ               ‚îÇ
‚îÇ        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò               ‚îÇ
‚îÇ                             ‚îÇ                                     ‚îÇ
‚îÇ                             ‚ñº                                     ‚îÇ
‚îÇ                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                           ‚îÇ
‚îÇ                    ‚îÇ Smart Comparator‚îÇ                           ‚îÇ
‚îÇ                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                           ‚îÇ
‚îÇ                             ‚îÇ                                     ‚îÇ
‚îÇ              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îÇ
‚îÇ              ‚ñº              ‚ñº               ‚ñº                    ‚îÇ
‚îÇ        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê               ‚îÇ
‚îÇ        ‚îÇ  Hash   ‚îÇ    ‚îÇOpenAPI  ‚îÇ    ‚îÇ  HTML   ‚îÇ               ‚îÇ
‚îÇ        ‚îÇ Compare ‚îÇ    ‚îÇStruct   ‚îÇ    ‚îÇ  Text   ‚îÇ               ‚îÇ
‚îÇ        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò               ‚îÇ
‚îÇ                             ‚îÇ                                     ‚îÇ
‚îÇ                             ‚ñº                                     ‚îÇ
‚îÇ                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                           ‚îÇ
‚îÇ                    ‚îÇ  Has Changes?   ‚îÇ                           ‚îÇ
‚îÇ                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                           ‚îÇ
‚îÇ                             ‚îÇ                                     ‚îÇ
‚îÇ                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                           ‚îÇ
‚îÇ                    ‚îÇ       YES       ‚îÇ                           ‚îÇ
‚îÇ                    ‚ñº                 ‚ñº                           ‚îÇ
‚îÇ            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                  ‚îÇ
‚îÇ            ‚îÇ  Gemini AI   ‚îÇ   ‚îÇ  Categorize  ‚îÇ                  ‚îÇ
‚îÇ            ‚îÇ   Analysis   ‚îÇ   ‚îÇ   (OpenAPI)  ‚îÇ                  ‚îÇ
‚îÇ            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                  ‚îÇ
‚îÇ                   ‚îÇ                   ‚îÇ                           ‚îÇ
‚îÇ                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                          ‚îÇ
‚îÇ                             ‚ñº                                     ‚îÇ
‚îÇ                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                           ‚îÇ
‚îÇ                    ‚îÇ  Save Snapshot  ‚îÇ                           ‚îÇ
‚îÇ                    ‚îÇ   + AI Summary  ‚îÇ                           ‚îÇ
‚îÇ                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                           ‚îÇ
‚îÇ                             ‚îÇ                                     ‚îÇ
‚îÇ                             ‚ñº                                     ‚îÇ
‚îÇ                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                           ‚îÇ
‚îÇ                    ‚îÇ Slack Notifier  ‚îÇ                           ‚îÇ
‚îÇ                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîÑ Workflow –¥–µ—Ç–∞–ª—å–Ω–æ

### 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

```python
watcher = APIWatcherV2()
‚îú‚îÄ‚îÄ DatabaseManager (SQLite/PostgreSQL)
‚îú‚îÄ‚îÄ ZenRowsClient (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
‚îú‚îÄ‚îÄ GeminiAnalyzer (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
‚îú‚îÄ‚îÄ SlackNotifier (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
‚îî‚îÄ‚îÄ SmartComparator
```

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ URL

```
process_url(url, api_name, method_name)
‚îÇ
‚îú‚îÄ‚ñ∂ fetch_content(url)
‚îÇ   ‚îú‚îÄ‚ñ∂ ZenRows (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚ñ∂ –ü–æ–ø—ã—Ç–∫–∞ 1: –±–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚ñ∂ –ü–æ–ø—ã—Ç–∫–∞ 2: –ø—Ä–µ–º–∏—É–º –ø—Ä–æ–∫—Å–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚ñ∂ –ü–æ–ø—ã—Ç–∫–∞ 3: –±–µ–∑ JS —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
‚îÇ   ‚îî‚îÄ‚ñ∂ requests (fallback)
‚îÇ
‚îú‚îÄ‚ñ∂ detect_content_type(url, content)
‚îÇ   ‚îú‚îÄ‚ñ∂ 'openapi' (–µ—Å–ª–∏ OpenAPI/Swagger)
‚îÇ   ‚îú‚îÄ‚ñ∂ 'json' (–µ—Å–ª–∏ –≤–∞–ª–∏–¥–Ω—ã–π JSON)
‚îÇ   ‚îî‚îÄ‚ñ∂ 'html' (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
‚îÇ
‚îú‚îÄ‚ñ∂ get_latest_snapshot(url)
‚îÇ   ‚îú‚îÄ‚ñ∂ –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–µ—Ä–≤—ã–π —Å–Ω—ç–ø—à–æ—Ç
‚îÇ   ‚îî‚îÄ‚ñ∂ –ï—Å–ª–∏ –µ—Å—Ç—å ‚Üí –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
‚îÇ
‚îî‚îÄ‚ñ∂ _compare_content(old, new, type)
    ‚îú‚îÄ‚ñ∂ OpenAPI ‚Üí _compare_openapi()
    ‚îú‚îÄ‚ñ∂ JSON ‚Üí _compare_json()
    ‚îî‚îÄ‚ñ∂ HTML ‚Üí _compare_html()
```

### 3. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ OpenAPI

```
_compare_openapi(old_spec, new_spec)
‚îÇ
‚îú‚îÄ‚ñ∂ –°—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ (DeepDiff)
‚îÇ   ‚îú‚îÄ‚ñ∂ –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å: version, servers
‚îÇ   ‚îî‚îÄ‚ñ∂ –°—Ä–∞–≤–Ω–∏—Ç—å: paths, schemas, parameters
‚îÇ
‚îú‚îÄ‚ñ∂ –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ—Ç ‚Üí return False
‚îÇ
‚îú‚îÄ‚ñ∂ –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –µ—Å—Ç—å:
‚îÇ   ‚îú‚îÄ‚ñ∂ categorize_openapi_changes()
‚îÇ   ‚îÇ   ‚îú‚îÄ‚ñ∂ new_endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚ñ∂ removed_endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚ñ∂ modified_endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚ñ∂ schema_changes
‚îÇ   ‚îÇ   ‚îî‚îÄ‚ñ∂ breaking_changes
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚ñ∂ Gemini AI: analyze_openapi_changes()
‚îÇ   ‚îÇ   ‚îî‚îÄ‚ñ∂ –°–æ–∑–¥–∞—Ç—å —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—É—é —Å–≤–æ–¥–∫—É
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚ñ∂ –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å severity:
‚îÇ   ‚îÇ   ‚îú‚îÄ‚ñ∂ major (breaking changes)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚ñ∂ moderate (new/removed endpoints)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚ñ∂ minor (–æ—Å—Ç–∞–ª—å–Ω–æ–µ)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚ñ∂ save_snapshot() –≤ –ë–î
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚ñ∂ Slack: send_change_notification()
‚îÇ
‚îî‚îÄ‚ñ∂ return result
```

### 4. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ HTML

```
_compare_html(old_html, new_html)
‚îÇ
‚îú‚îÄ‚ñ∂ –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ —Ö–µ—à—É
‚îÇ   ‚îî‚îÄ‚ñ∂ –ï—Å–ª–∏ —Ö–µ—à–∏ —Ä–∞–≤–Ω—ã ‚Üí return False
‚îÇ
‚îú‚îÄ‚ñ∂ html_to_text() –¥–ª—è –æ–±–æ–∏—Ö –≤–µ—Ä—Å–∏–π
‚îÇ   ‚îî‚îÄ‚ñ∂ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è HTML ‚Üí —á–∏—Ç–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç
‚îÇ
‚îú‚îÄ‚ñ∂ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚ñ∂ –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è ‚Üí return False
‚îÇ
‚îú‚îÄ‚ñ∂ Gemini AI: analyze_changes()
‚îÇ   ‚îú‚îÄ‚ñ∂ –ü—Ä–æ–º–ø—Ç: "–û–ø—Ä–µ–¥–µ–ª–∏ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è"
‚îÇ   ‚îú‚îÄ‚ñ∂ –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å: –æ–ø–µ—á–∞—Ç–∫–∏, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚ñ∂ –í–µ—Ä–Ω—É—Ç—å: has_significant_changes, summary, key_changes
‚îÇ
‚îú‚îÄ‚ñ∂ –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ:
‚îÇ   ‚îú‚îÄ‚ñ∂ save_snapshot(has_changes=False)
‚îÇ   ‚îî‚îÄ‚ñ∂ return False (–±–µ–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
‚îÇ
‚îú‚îÄ‚ñ∂ –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ:
‚îÇ   ‚îú‚îÄ‚ñ∂ save_snapshot(has_changes=True, ai_summary)
‚îÇ   ‚îî‚îÄ‚ñ∂ Slack: send_change_notification()
‚îÇ
‚îî‚îÄ‚ñ∂ return result
```

### 5. –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç

```
send_weekly_digest()
‚îÇ
‚îú‚îÄ‚ñ∂ get_snapshots_with_changes(days=7)
‚îÇ   ‚îî‚îÄ‚ñ∂ –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞ –Ω–µ–¥–µ–ª—é –∏–∑ –ë–î
‚îÇ
‚îú‚îÄ‚ñ∂ –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚ñ∂ api_name
‚îÇ   ‚îú‚îÄ‚ñ∂ method_name
‚îÇ   ‚îú‚îÄ‚ñ∂ url
‚îÇ   ‚îú‚îÄ‚ñ∂ summary (AI-—Å–≤–æ–¥–∫–∞)
‚îÇ   ‚îî‚îÄ‚ñ∂ created_at
‚îÇ
‚îî‚îÄ‚ñ∂ Slack: send_weekly_digest(changes)
    ‚îú‚îÄ‚ñ∂ –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π
    ‚îú‚îÄ‚ñ∂ –°–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–¥–æ 10)
    ‚îî‚îÄ‚ñ∂ –ö–Ω–æ–ø–∫–∏ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
```

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞: snapshots

```sql
CREATE TABLE snapshots (
    id              INTEGER PRIMARY KEY AUTOINCREMENT,
    url             VARCHAR(500) NOT NULL,
    api_name        VARCHAR(200),
    method_name     VARCHAR(200),
    content_type    VARCHAR(50),      -- 'html', 'openapi', 'json'
    
    -- –ö–æ–Ω—Ç–µ–Ω—Ç
    raw_html        TEXT,              -- –°—ã—Ä–æ–π HTML
    text_content    TEXT,              -- –¢–µ–∫—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è
    structured_data TEXT,              -- JSON –¥–ª—è OpenAPI/JSON
    
    -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    created_at      DATETIME DEFAULT CURRENT_TIMESTAMP,
    has_changes     BOOLEAN DEFAULT 0,
    ai_summary      TEXT,              -- AI-—Å–≤–æ–¥–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    content_hash    VARCHAR(64),       -- SHA-256 —Ö–µ—à
    
    -- –ò–Ω–¥–µ–∫—Å—ã
    INDEX idx_url (url),
    INDEX idx_created_at (created_at),
    INDEX idx_has_changes (has_changes)
);
```

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

```sql
-- –ü–æ—Å–ª–µ–¥–Ω–∏–π —Å–Ω—ç–ø—à–æ—Ç –¥–ª—è URL
SELECT * FROM snapshots 
WHERE url = 'https://api.example.com/docs' 
ORDER BY created_at DESC 
LIMIT 1;

-- –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
SELECT api_name, method_name, created_at, ai_summary 
FROM snapshots 
WHERE url = 'https://api.example.com/docs' 
  AND has_changes = 1 
ORDER BY created_at DESC;

-- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞ –Ω–µ–¥–µ–ª—é
SELECT * FROM snapshots 
WHERE has_changes = 1 
  AND created_at >= datetime('now', '-7 days') 
ORDER BY created_at DESC;

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ API
SELECT 
    api_name,
    COUNT(*) as total_checks,
    SUM(has_changes) as changes_count
FROM snapshots 
GROUP BY api_name;
```

## üîå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### ZenRows API

```python
class ZenRowsClient:
    BASE_URL = "https://api.zenrows.com/v1/"
    
    def fetch_html(url, js_render=True, premium_proxy=False, antibot=True):
        params = {
            'apikey': api_key,
            'url': url,
            'js_render': 'true' if js_render else 'false',
            'premium_proxy': 'true' if premium_proxy else 'false',
            'antibot': 'true' if antibot else 'false'
        }
        response = requests.get(BASE_URL, params=params)
        return response.text
```

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è fallback:**
1. –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (js_render=True, premium_proxy=False)
2. –° –ø—Ä–µ–º–∏—É–º –ø—Ä–æ–∫—Å–∏ (js_render=True, premium_proxy=True)
3. –ë–µ–∑ JS (js_render=False, premium_proxy=False)

### Gemini AI

```python
class GeminiAnalyzer:
    def analyze_changes(old_text, new_text):
        prompt = f"""
        –°—Ä–∞–≤–Ω–∏ –¥–≤–∞ —Ç–µ–∫—Å—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –æ–ø—Ä–µ–¥–µ–ª–∏:
        1. –ï—Å—Ç—å –ª–∏ –°–£–©–ï–°–¢–í–ï–ù–ù–´–ï –∏–∑–º–µ–Ω–µ–Ω–∏—è?
        2. –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
        3. –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–ø–∏—Å–∫–æ–º
        
        –°–¢–ê–†–ê–Ø –í–ï–†–°–ò–Ø: {old_text[:15000]}
        –ù–û–í–ê–Ø –í–ï–†–°–ò–Ø: {new_text[:15000]}
        
        –û—Ç–≤–µ—Ç—å –≤ JSON:
        {{
            "has_significant_changes": true/false,
            "summary": "...",
            "key_changes": [...],
            "severity": "minor/moderate/major"
        }}
        """
        
        response = model.generate_content(prompt)
        return parse_json(response.text)
```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞: 15000 —Å–∏–º–≤–æ–ª–æ–≤ (—á—Ç–æ–±—ã –Ω–µ –ø—Ä–µ–≤—ã—Å–∏—Ç—å –ª–∏–º–∏—Ç —Ç–æ–∫–µ–Ω–æ–≤)
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ: AI –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- Fallback: –µ—Å–ª–∏ AI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∞–∑–æ–≤–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ

### Slack API

```python
class SlackNotifier:
    def send_change_notification(api_name, summary, severity):
        blocks = [
            {
                "type": "header",
                "text": {"type": "plain_text", "text": f"{emoji} {api_name}"}
            },
            {
                "type": "section",
                "text": {"type": "mrkdwn", "text": f"*–°–≤–æ–¥–∫–∞:*\n{summary}"}
            },
            {
                "type": "section",
                "fields": [
                    {"type": "mrkdwn", "text": f"*API:*\n{api_name}"},
                    {"type": "mrkdwn", "text": f"*–í–∞–∂–Ω–æ—Å—Ç—å:*\n{severity}"}
                ]
            }
        ]
        
        client.chat_postMessage(channel=channel, blocks=blocks)
```

**–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –≠–º–æ–¥–∑–∏ –ø–æ severity: üîµ minor, üü° moderate, üî¥ major
- –ë–ª–æ—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
- –ö–Ω–æ–ø–∫–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **–ë—ã—Å—Ç—Ä–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ —Ö–µ—à—É**
   - SHA-256 —Ö–µ—à –∫–æ–Ω—Ç–µ–Ω—Ç–∞
   - –ï—Å–ª–∏ —Ö–µ—à–∏ —Ä–∞–≤–Ω—ã ‚Üí –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ

2. **–°—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ OpenAPI**
   - DeepDiff –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
   - AI —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π

3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ë–î**
   - –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ url, created_at, has_changes
   - –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–Ω—ç–ø—à–æ—Ç–∞

4. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å (–±—É–¥—É—â–µ–µ —É–ª—É—á—à–µ–Ω–∏–µ)**
   - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö URLs
   - Async/await –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤

### –ú–µ—Ç—Ä–∏–∫–∏

```python
# –¢–∏–ø–∏—á–Ω–æ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–¥–Ω–æ–≥–æ URL:
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞: 1-3 —Å–µ–∫ (ZenRows), 0.5-1 —Å–µ–∫ (direct)
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ —Ö–µ—à—É: <0.01 —Å–µ–∫
- –°—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ OpenAPI: 0.1-0.5 —Å–µ–∫
- AI –∞–Ω–∞–ª–∏–∑ (Gemini): 2-5 —Å–µ–∫
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î: <0.1 —Å–µ–∫
- –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Slack: 0.5-1 —Å–µ–∫

–ò—Ç–æ–≥–æ: 4-10 —Å–µ–∫ –Ω–∞ URL (—Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏), 1-4 —Å–µ–∫ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤

```bash
# .env —Ñ–∞–π–ª (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å –≤ git!)
ZENROWS_API_KEY=secret
GEMINI_API_KEY=secret
SLACK_BOT_TOKEN=secret
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```python
# URL –≤–∞–ª–∏–¥–∞—Ü–∏—è
if not url.startswith(('http://', 'https://')):
    raise ValueError("Invalid URL")

# –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
MAX_CONTENT_SIZE = 10 * 1024 * 1024  # 10 MB
if len(content) > MAX_CONTENT_SIZE:
    raise ValueError("Content too large")
```

### Rate limiting

```python
# –î–ª—è API —Å –ª–∏–º–∏—Ç–∞–º–∏
import time

for url in urls:
    process_url(url)
    time.sleep(1)  # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
```

## üöÄ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
# –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ URLs –º–µ–∂–¥—É –≤–æ—Ä–∫–µ—Ä–∞–º–∏
urls_chunk_1 = urls[0:100]
urls_chunk_2 = urls[100:200]

# –í–æ—Ä–∫–µ—Ä 1
python -m watcher_v2 --urls urls_chunk_1.json

# –í–æ—Ä–∫–µ—Ä 2
python -m watcher_v2 --urls urls_chunk_2.json
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ PostgreSQL

```env
DATABASE_URL=postgresql://user:pass@localhost/api_watcher
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –∏ –±—ç–∫–∞–ø—ã

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```python
# Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
import redis

cache = redis.Redis(host='localhost', port=6379)

def get_cached_content(url):
    cached = cache.get(f"content:{url}")
    if cached:
        return cached.decode('utf-8')
    return None

def cache_content(url, content, ttl=3600):
    cache.setex(f"content:{url}", ttl, content)
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
import logging

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('api_watcher.log'),
        logging.StreamHandler()
    ]
)
```

### –ú–µ—Ç—Ä–∏–∫–∏

```python
# –°–æ–±–∏—Ä–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏
metrics = {
    'total_urls': len(urls),
    'changed': sum(1 for r in results if r['has_changes']),
    'errors': sum(1 for r in results if 'error' in r),
    'duration': time.time() - start_time
}

# –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
send_to_prometheus(metrics)
```

---

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è:**
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- ‚úÖ –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç–∏
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
